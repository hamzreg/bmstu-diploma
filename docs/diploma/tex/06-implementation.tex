\chapter{Технологический раздел}

\section{Выбор средств программной реализации}

Для выполнения оптимизации сжатия страниц памяти была выбрана операционная система Linux в соответствии со сравнением систем, проведенном в разделе \ref{os}. Согласно анализу модулей сжатия, представленному в разделе \ref{linux-compression}, был выбран загружаемый модуль zram. В качестве языка программирования был выбран язык C \cite{c}, так как большая часть исходного кода ядра операционной системы Linux и всех ее модулей написана на данном языке программирования.

Для сборки программного обеспечения выбрана утилита GNU make \cite{make}, так как с помощью данной утилиты осуществляется сборка загружаемых модулей ядра.

\section{Детали реализации}

В листинге \ref{lst:get_entropy.c} приведена реализация разработанного метода подсчета информационной энтропии. Размер страницы в байтах в ядре Linux определяется константой PAGE\_SIZE \cite{block-file}.

\includelistingpretty
    {get_entropy.c}
    {C}
    {Реализация метода подсчета информационной энтропии}

В листинге \ref{lst:write_page.c} представлена часть реализации записи страницы на диск в модуле блочного устройства. ENTROPY\_TRESHOLD --- константа, определяющая пороговое значение и устанавливаемая перед сборкой программного обеспечения.

\includelistingpretty
    {write_page.c}
    {C}
    {Часть реализации записи страницы на диск}

\section{Конфигурация программного обеспечения}

Для сборки и запуска программного обеспечения необходимо выполнить следующие действия:

\begin{enumerate}
    \item получить исполняемый файл программного обеспечения;
    \item загрузить полученный модуль.
\end{enumerate}

При загрузке модуля автоматически создается диск zram с идентификатором 0. Для корректной работы программного обеспечения нужно настроить созданный диск:

\begin{enumerate}
    \item установить алгоритм сжатия из доступных в системе;
    \item установить размер диска, для указания единиц измерения которого используются следующие постфиксы: K --- размер в килобайтах, M --- размер в мегабайт, G --- размер в гигабайтах, размер в байтах устанавливается при отсутствии постфикса.
\end{enumerate}

При получении статистики во время тестирования анализируются файл статистики памяти диска mm\_stat и сообщения системного журнала.

Для остановки работы программного обеспечения необходимо выгрузить модуль. При этом автоматически удаляются все созданные диски zram.

Для выполнения при сборке, запуске, тестировании и остановке программного обеспечения и настройке диска описанных действий был написан make-файл, код которого показан в листинге \ref{lst:Makefile}. В таблице представлено описание доступных команд.

\includelistingpretty
    {Makefile}
    {C}
    {Конфигурационный файл}

\begin{table}[h]
    \caption{Команды конфигурационного файла}
    \begin{center}
        \begin{tabular}{|l|l|l|l|l|l|}
                \hline
            \multicolumn{1}{|c}{\textbf{Команда}} & 
            \multicolumn{1}{|c|}{\textbf{Аргументы}} &
            \multicolumn{1}{c|}{\textbf{Описание}} \\ \hline
            make & - & собрать загружаемый модуль \\ \hline
            make load & - & загрузить собранный модуль \\ \hline
            make info & - & проверить, что модуль загружен \\ \hline
            \multicolumn{1}{|l}{make log} & \multicolumn{1}{|l}{-} & \multicolumn{1}{|l|}{получить сообщения} \\
            \multicolumn{1}{|l}{} & \multicolumn{1}{|l}{} & \multicolumn{1}{|l|}{системного журнала} \\ \hline
            make unload & - & выгрузить модуль \\ \hline
            \multicolumn{1}{|l}{make add-disk} & \multicolumn{1}{|l}{-} & \multicolumn{1}{|l|}{добавить диск, будет выведен} \\
            \multicolumn{1}{|l}{} & \multicolumn{1}{|l}{} & \multicolumn{1}{|l|}{его идентификатор} \\ \hline
            \multicolumn{1}{|l}{make} & \multicolumn{1}{|l}{id --- идентификатор} & \multicolumn{1}{|l|}{получить список} \\
            \multicolumn{1}{|l}{get-comp-algorithm} & \multicolumn{1}{|l}{диска} & \multicolumn{1}{|l|}{доступных алгоритмов сжатия} \\ \hline
            \multicolumn{1}{|l}{make} & \multicolumn{1}{|l}{algorithm --- алгоритм} & \multicolumn{1}{|l|}{установить алгоритм сжатия} \\
            \multicolumn{1}{|l}{set-comp-algorithm} & \multicolumn{1}{|l}{сжатия} & \multicolumn{1}{|l|}{} \\
            \multicolumn{1}{|l}{} & \multicolumn{1}{|l}{id --- идентификатор} & \multicolumn{1}{|l|}{} \\
            \multicolumn{1}{|l}{} & \multicolumn{1}{|l}{диска} & \multicolumn{1}{|l|}{} \\ \hline
            \multicolumn{1}{|l}{make} & \multicolumn{1}{|l}{disksize --- размер} & \multicolumn{1}{|l|}{установить размер диска} \\
            \multicolumn{1}{|l}{set-disksize} & \multicolumn{1}{|l}{диска} & \multicolumn{1}{|l|}{} \\
            \multicolumn{1}{|l}{} & \multicolumn{1}{|l}{id --- идентификатор} & \multicolumn{1}{|l|}{} \\
            \multicolumn{1}{|l}{} & \multicolumn{1}{|l}{диска} & \multicolumn{1}{|l|}{} \\ \hline
            \multicolumn{1}{|l}{make} & \multicolumn{1}{|l}{id --- идентификатор} & \multicolumn{1}{|l|}{получить статистику} \\
            \multicolumn{1}{|l}{memory-stat} & \multicolumn{1}{|l}{диска} & \multicolumn{1}{|l|}{памяти диска} \\ \hline
            \multicolumn{1}{|l}{make} & \multicolumn{1}{|l}{id --- идентификатор} & \multicolumn{1}{|l|}{освободить память диска} \\
            \multicolumn{1}{|l}{reset-disk} & \multicolumn{1}{|l}{диска} & \multicolumn{1}{|l|}{} \\ \hline
            \multicolumn{1}{|l}{make} & \multicolumn{1}{|l}{id --- идентификатор} & \multicolumn{1}{|l|}{удалить диск} \\
            \multicolumn{1}{|l}{remove-disk} & \multicolumn{1}{|l}{диска} & \multicolumn{1}{|l|}{} \\ \hline
        \end{tabular}
    \end{center}
    \label{tab:comparison}
\end{table}

\section{Тестирование разработанного программного обеспечения}

Тестирование разработанного программного обеспечения проводилось с помощью тестовых наборов, которые представляют собой архивы, созданные с помощью утилиты tar \cite{tar} следующей командой: tar cf name.tar name, где name --- имя тестового набора. 

В соответствии с выделенными классами эквивалентности были созданы следующие тестовые наборы:

\begin{itemize}
    \item bin-test.tar --- архив, содержащий бинарные файлы;
    \item text-test.tar --- архив, состоящий из файлов с расширением .h;
    \item pdf-test.tar --- архив, включающий в себя файлы с расширением .pdf;
    \item img-test.tar --- архив, составленный из файлов с расширением .jpg.
\end{itemize}

Загрузка данных в устройство выполнялась следующей командой: dd if=name.tar of=/dev/zram0, где name --- имя тестового набора.

В результате тестирования были получены следующие результаты.

TODO: добавить статистику по каждому тестовому набору и пояснения к ней.

\section*{Вывод}

В данном разделе был обоснован выбор языка программирования C и утилиты make в качестве средств программной реализации. Были представлены детали реализации программного решения. Кроме того были изложены команды для сборки и запуска программного обеспечения и настройки устройства zram. Были описаны результаты тестирования разработанного программного обеспечения.
